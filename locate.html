<!DOCTYPE html>
<html>
  <head>
    <title>250 taxi</title>
      
    <link href="animate.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="pushmenu/jPushMenu.css" />
      
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDb1A29Jk9FtTZSiHDlfUPM9mHM42cAiRo&signed_in=false&sensor=true"></script>
      
<script src="jquery.min.js"></script>
<script src="pushmenu/jPushMenu.js"></script>
<script src="pushmenu/mainmenu.js"></script>
      
<style>
html, body, #map {
    margin: 0;
    padding: 0;
    height: 100%
}
#locationfield {
        font-family: Roboto, sans-serif;
        text-indent: 5px;
	    font-size: 16px;
        position: absolute;
        background-color: rgba(255,255,255,0.9);
        width: 84%;
        left: 14%;
        height: 15%;
        z-index: 100;
        top: 8px;
        border: 0px solid #FFFFFF;
        max-height: 30px;
}
#menubutton {
        background-image: url(menu.svg);
        background-size: auto 80%;
        background-position: center center;
        background-repeat: no-repeat;
        position: absolute;
        height: 15%;
        width: 10%;
        z-index: 102;
        max-width: 30px;
        border: 1px solid #FFFFFF;     
        top: 8px;
        left: 2%;
        background-color: rgba(255,255,255,0.9);
        max-height: 30px;
}
#locationbutton {
        background-image: url(crosshairs-gps.svg);
        background-size: auto 80%;
        background-position: center center;
        background-repeat: no-repeat;
        position: absolute;
        height: 15%;
        width: 10%;
        z-index: 100;
        max-width: 30px;
        border: 1px solid #FFFFFF;     
        top: 47px;
        right: 2%;
        background-color: rgba(255,255,255,0.9);
        max-height: 30px;
}
#calltaxiui {
        background-image: url(calltaxi.png);
        background-size: 100% 100%;
        background-repeat: no-repeat;
        background-position: center bottom;
        width: 100%;
        height: 100px;
        position: absolute;
        bottom: 0px;
        z-index: 100;
}
#logoutbutton {
        font-family: Roboto, sans-serif;
	    font-size: 16px;
        border: 1px solid #FFFFFF;
        padding-top: 5px;
        padding-bottom: 5px;
        padding-left: 20px;
        padding-right: 20px;
        color: white;
        margin-left: 30%;
}
#overlay {
    background-image: url(directions.png);
    background-size: 100% 100%;
    opacity: 0.7;
	position: absolute;
	z-index: 10000000000000000;
	height: 100%;
	width: 100%;
	left: 0px;
	top: 0px;
}
#loadingindicator {
	background-color: #E2E2E2;
	position: absolute;
	z-index: 10000000000000000;
	height: 100%;
	width: 100%;
	left: 0px;
	top: 0px;
	text-align: center;
}
#loadingindicator img {
	margin-top: 100px;
	width: 160px;
}
#divider {
    height: 1px;
    width: 100%;
    display: block;
    background-color: lightgrey;
}
#pages {
        width: 96%;
        height: 100%;
        top: 0;
        left: 0;
        position: absolute;
        z-index: 102;
        background-color: black;
        display: none;
        padding-top: 50px;
        padding-left: 2%;
        padding-right: 2%;
        background-image: url(reg/kigali_blur.jpg);
        background-size: 100% 100%;
}
#pagestarget {

}
</style>

</head>


<body>
    
<div id="pages">
<div id="pagestarget">

</div>
</div>
    
<div id="overlay" onclick="this.style.display = 'none'"></div>
    
<div id="loadingindicator">
<img src="282.gif" width="120">
</div>
    
<script>
    function logout() {
    localStorage.removeItem('rememberuser');
    document.location.href = 'index.html';
    }
</script>
    
<nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left">
    
<br>
<span id="logoutbutton" onclick="logout();">Logout</span>
<br><br>
    
			<div id="mainmenu_services">Services</div>
			<div id="mainmenu_account">Account</div>
			<div id="mainmenu_promotions">Promotions</div>
            <div id="mainmenu_history">History</div>
            <span id="divider"></span>
			<div id="mainmenu_becomedriver">BECOME A 250TAXI DRIVER</div>
			<div id="mainmenu_corporate">250TAXI CORPORATE</div>
            <div id="mainmenu_about">ABOUT</div>
            <div id="mainmenu_help">HELP</div>
</nav>
          
<input style="display:none;" id="lat" name="lat" val="40.713956">
<input style="display:none;" id="long" name="long" val="74.006653">
    
<div id="menubutton" class="toggle-menu menu-left"> </div>    
<input id="locationfield" name="address" val="">

<div id="locationbutton" onclick="reloadPositionStart();"> </div>    

    
    <div id="calltaxiui"></div>
    
    <div id="map"></div>


<script>
    
function showindicator() {
document.getElementById("loadingindicator").className = "animated fadeIn";
document.getElementById("loadingindicator").style.display = "block";
}
function hideindicator() {
document.getElementById("loadingindicator").className = "animated fadeOut";
setTimeout(function(){
document.getElementById("loadingindicator").style.display = "none";
}, 1000);
}


var marker;
var infoWindow;
    
function reloadPositionStart() {
    document.getElementById('locationbutton').style.backgroundImage = 'crosshairs-gps_blue.svg';
    setTimeout(function(){
    reloadPosition();
    document.getElementById('locationbutton').style.backgroundImage = 'crosshairs-gps.svg';
    }, 6000);
}
    
function reloadPosition() {
navigator.geolocation.getCurrentPosition(
				displayPosition, 
				displayError, {
                enableHighAccuracy: true,
                timeout: timeoutVal,
                maximumAge: 0
                }
			);
pos;
// alert('reloaded: '+pos+'');
}

if (navigator.geolocation) {
    
			var timeoutVal = 10 * 1000 * 1000;

			navigator.geolocation.getCurrentPosition(
				displayPosition, 
				displayError, {
                enableHighAccuracy: true,
                timeout: timeoutVal,
                maximumAge: 0
                }
			);
            
}
else {
alert("Geolocation is not supported");
}

function displayPosition(position) {	
            
            document.getElementById("lat").value = position.coords.latitude;
            document.getElementById("long").value = position.coords.longitude;     
            
			pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            
            geocodeLatLng(geocoder, map);
            
			var options = {
				zoom: 16,
                disableDefaultUI: true,
				center: pos,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
                styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }]}]
			};
			var map = new google.maps.Map(document.getElementById("map"), options);
			// Remove the current marker, if there is one
			if (typeof(marker) != "undefined") marker.setMap(null);
            
var iconimage = {
    url: "userpinicon.png", // url
    scaledSize: new google.maps.Size(90, 90), // scaled size
    origin: new google.maps.Point(0,0), // origin
    anchor: new google.maps.Point(43,90) // anchor
};
            
			marker = new google.maps.Marker({
                draggable: true,
                // icon: "userpinicon.png",
                icon: iconimage,
				position: pos,
				map: map,
				title: "User location"
			});
            
            google.maps.event.addListener(marker, 'dragend', function (event) {
            document.getElementById("lat").value = event.latLng.lat();
            document.getElementById("long").value = event.latLng.lng();
            geocodeLatLng(geocoder, map);
            });

            // get coordinates from marker?
            google.maps.event.addListener(marker, 'dragend', function(evt){
            // document.getElementById('current').innerHTML = '<p>Marker dropped: Current Lat: ' +         evt.latLng.lat().toFixed(3) + ' Current Lng: ' + evt.latLng.lng().toFixed(3) + '</p>';
                
            pos = new google.maps.LatLng(evt.latLng.lat().toFixed(3),evt.latLng.lng().toFixed(3));
                
            // alert('Marker dropped: Current Lat: '+evt.latLng.lat().toFixed(3)+' Current Lng: '+evt.latLng.lng().toFixed(3)+' Pos: '+pos+'');
            
            geocodeLatLng(geocoder, map);
                
            });
                
			var contentString = "<b>Timestamp:</b> " + parseTimestamp(position.timestamp) + "<br/><b>User location:</b> lat " + position.coords.latitude + ", long " + position.coords.longitude + ", accuracy " + position.coords.accuracy;
			// Remove the current infoWindow, if there is one
			
            if (typeof(infoWindow) != "undefined") infoWindow.setMap(null);
			infowindow = new google.maps.InfoWindow({
				content: contentString
			});
            
			// google.maps.event.addListener(marker, 'click', function() {
			//	infowindow.open(map,marker);
			// });
            
		}
		function displayError(error) {
			var errors = { 
				1: 'Permission denied',
				2: 'Position unavailable',
				3: 'Request timeout'
			};
			alert("Error: " + errors[error.code]);
		}
		function parseTimestamp(timestamp) {
			var d = new Date(timestamp);
			var day = d.getDate();
			var month = d.getMonth() + 1;
			var year = d.getFullYear();
			var hour = d.getHours();
			var mins = d.getMinutes();
			var secs = d.getSeconds();
			var msec = d.getMilliseconds();
			return day + "." + month + "." + year + " " + hour + ":" + mins + ":" + secs + "," + msec;
		}
    
var geocoder = new google.maps.Geocoder;
    
function geocodeLatLng(geocoder, map) {
    
  // var input = String(pos);
    
  // var latlngStr = input.split(',', 2);
    
  // var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
    
  geocoder.geocode({'location': pos}, function(results, status) {
    if (status === google.maps.GeocoderStatus.OK) {
      if (results[1]) {
        // infowindow.setContent(results[1].formatted_address);
        // infowindow.open(map, marker);
        document.getElementById('locationfield').value = results[0].formatted_address;
      } 
    else {
        // window.alert('No results found');
      }
    } 
    else {
      // window.alert('Geocoder failed due to: ' + status);
    }
  });
}

jQuery(document).ready(function($) {
	$('.toggle-menu').jPushMenu();
    
    document.getElementById("loadingindicator").className = "animated fadeOut";
setTimeout(function(){
document.getElementById("loadingindicator").style.display = "none";
}, 2000);
});

</script>

</body>
</html>