<!doctype html>
<html>

<head>

    <meta charset="utf-8">
    
    <link rel="apple-touch-icon" sizes="57x57" href="../apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../manifest.json">
<meta name="msapplication-TileColor" content="#df600a">
<meta name="msapplication-TileImage" content="../mstile-144x144.png">
<meta name="theme-color" content="#000000">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link href="main.css" rel="stylesheet" type="text/css">
    <link href="animate.min.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" charset="utf-8" src="jquery-1.9.1.js"></script>
    <script type="text/javascript" charset="utf-8" src="logic.js"></script>
    <script type="text/javascript" charset="utf-8" src="../logupdate.js"></script>

    <script type="text/javascript" charset="utf-8" src="../materialize.js"></script>
    <link href="../waves.css" rel="stylesheet" type="text/css">

    <script type="text/javascript" charset="utf-8" src="../cordova.js"></script>

    <script src="../preventreload.js"></script>

    <script type="text/javascript">
		
		function showindicator() {
            document.getElementById("loadingindicator").className = "animated fadeIn";
            document.getElementById("loadingindicator").style.display = "block";
        }
		function hideindicator() {
            document.getElementById("loadingindicator").style.display = "none";
        }
		
        $(document).ready(function() {
			
			var currentTime = new Date().getHours();
			
            if (0 <= currentTime && currentTime < 5) {
               document.getElementById("mainbg").style.backgroundImage = "url('kigali_night.jpg')";
				document.getElementById("mainbg").style.backgroundSize = "auto 100%";
            }
            if (5 <= currentTime && currentTime < 11) {
				 document.getElementById("mainbg").style.backgroundImage = "url('kigali_day.jpg')";
            }
            if (11 <= currentTime && currentTime < 16) {
				 document.getElementById("mainbg").style.backgroundImage = "url('kigali_day.jpg')";
            }
            if (16 <= currentTime && currentTime < 17) {
				 document.getElementById("mainbg").style.backgroundImage = "url('kigali_day.jpg')";
            }
            if (17 <= currentTime && currentTime <= 24) {
                document.getElementById("mainbg").style.backgroundImage = "url('kigali_night.jpg')";
				document.getElementById("mainbg").style.backgroundSize = "auto 100%";
            }
        
			

            $('#username').keyup(function() {
                this.value = this.value.toLowerCase();
                this.value = this.value.replace(/[^@a-z0-9.]/g, "");
            });
            $(function() {
                $('#username').keypress(function(e) {
                    var txt = String.fromCharCode(e.which);
                    console.log(txt + ' : ' + e.which);
                    if (!txt.match(/[@.A-Za-z0-9]/)) //+#-.
                    {
                        return false;
                    }
                });
            });

            if (localStorage.getItem('username') === null) {
            var username = localStorage.getItem('username');
            document.getElementById('username').value = username;
            }

            setTimeout(function() {
                document.getElementById("loadingindicator").className = "animated fadeOut";
            }, 1000);
            setTimeout(function() {
                document.getElementById("loadingindicator").style.display = "none";
            }, 2000);

            setTimeout(function() {
                document.getElementById("mainmenu").style.display = "block";
                document.getElementById("mainmenu").className = "nicewindow animated fadeIn";
            }, 2500);
        });



		



        function scancode_hotel_corporate() {

            cordova.plugins.barcodeScanner.scan(
                function(result) {
                    // alert("We got a barcode\n" +
                    //   "Result: " + result.text + "\n" +
                    //   "Format: " + result.format + "\n" +
                    //   "Cancelled: " + result.cancelled);

                    is_cancelled = result.cancelled;

                    //  alert(is_cancelled);

                    if (is_cancelled == true) {
                        alert("Scanning cancelled. Please try again.")
                    } else if (is_cancelled == false) {

                        //  alert("Test");

                        localStorage.setItem("codefromqr_hotel_corporate", result.text);
                        codefromqr_hotel_corporate_login_after_scan();

                    }

                },
                function(error) {
                    alert("Scanning failed: " + error);
                }
            );

        }

        function rot13(str) {
            return str.replace(/[a-zA-Z]/g, function(chr) {
                var start = chr <= 'Z' ? 65 : 97;
                return String.fromCharCode(start + (chr.charCodeAt(0) - start + 13) % 26);
            });
        }

        function codefromqr_hotel_corporate_login_after_scan() {

            document.getElementById("loadingindicator").className = "animated fadeIn";

            var codefromqr_hotel_corporate = localStorage.getItem("codefromqr_hotel_corporate");
            var codefromqr_hotel_corporate = window.atob(codefromqr_hotel_corporate);
            var codefromqr_hotel_corporate = rot13(codefromqr_hotel_corporate);
            var codefromqr_hotel_corporate = codefromqr_hotel_corporate.substring(5);
            localStorage.setItem("codefromqr_hotel_corporate_decode", codefromqr_hotel_corporate);

            $.get("http://250taxi.com/db/partner/hotel/client_hotel_corporate_login.php?task=guest_name&hotel_card_id=" + codefromqr_hotel_corporate + "", function(data) {
                localStorage.setItem("cardid", codefromqr_hotel_corporate);
                localStorage.setItem("rememberuser", "Yes");
                localStorage.setItem("hotelcorporate", "Yes");
                localStorage.setItem("username", "hotelcorporate");
                localStorage.setItem("userid", "3");
                alert("Welcome to the 250TAXI hotel account. Request for the taxi and watch it approach you in real time within minutes. You will be able to use this card during your travel. Kindly return this card to the Hotel's administration once done with your journey. Enjoy your ride, " + data + "!");
                document.location.href = '../locate.html';
            });

        }

    </script>

</head>

<body id="mainbg" style="background-color: #000000;">

    <div id="offline" class="animated fadeIn">
        <img src="cloud.png">
        <div>You are offline. This app requires an active internet connection.</div>
    </div>

    <div id="loadingindicator" style="display:block;">
        <img src="../282.gif">
    </div>

    <div id="mainmenu" class="nicewindow" style="display:none;">

        <div id="loginscreenstart">
			
            <div class="heading_and_back"><div onClick="document.location.href = '../index.html';" class="backarrow"></div>Please Sign In</div>

			<div id="loginscreenstart_inputs">
            <input name="username" id="username" type="text" class="textfield" required placeholder="Username / E-Mail">

           <input id="loginpin" style="width:100px;" class="textfield pin" type="tel" placeholder="PIN" maxlength="4" pattern=".{4,}">
			</div>
			
			<div class="windowbutton waves-effect waves-dark" onClick="logincheck();">Sign in</div>
			
			<div id="forgotpw" onClick="location.href = 'forgot_password.html';">Forgot PIN?</div>

        </div>



        <script>
			function logincheck() {
				var username = document.getElementById('username').value;
				
				if(username.indexOf('@') === -1)
				{
					localStorage.setItem("username_check",username);
					logincheckgo();
				}
				else {
					$.get("http://250taxi.com/db/username_from_email.php?username=" + username + "", function(username) {
						localStorage.setItem("username_check",username);
						logincheckgo();
					});
				}
			}
            function logincheckgo() {
				
				showindicator();

                var username = localStorage.getItem("username_check");
				
                var loginpin = document.getElementById('loginpin').value;
				
				// alert(username);

                $.get("http://250taxi.com/db/check-username-login.php?task=checkusername&username=" + username + "", function(data) {
                    
                    // alert(data);

                    if (data == "account_found") {

                        $.get("http://250taxi.com/db/check-username-login.php?task=getuserid&username=" + username + "", function(userid) {

                            $.get("http://250taxi.com/db/check-pin.php?username=" + username + "&pin=" + loginpin + "", function(pindata) {

                                if (pindata == "pin_found") {
                                    localStorage.setItem("rememberuser", "Yes");
                                    localStorage.removeItem("hotelcorporate");
                                    localStorage.setItem("username", username);
                                    localStorage.setItem("userid", userid);

                                    localStorage.setItem("logupdate", "User <span class='log_userid'>" + userid + "</span> logged in");
                                    logupdate();

                                    var randomclientid = Math.floor(Math.random() * 1000000000);
                                    localStorage.setItem("randomclientid", randomclientid);

                                    console.log(randomclientid);
                                    
                                     var battery = navigator.battery || navigator.mozBattery;
if (battery) {
    // battery status for firefox 
        var device_battery = (battery.level * 100);
    localStorage.setItem("device_battery",device_battery);
} else if (navigator.getBattery) {
    //battery status for chrome
    navigator.getBattery().then(function(battery) {
        var device_battery = (battery.level * 100);
        localStorage.setItem("device_battery",device_battery);
    });
}
                                    
                             

                                    var device_model = localStorage.getItem("device_model");
                                    var device_platform = localStorage.getItem("device_platform");
                                    var device_version = localStorage.getItem("device_version");
                                    var device_uuid = localStorage.getItem("device_uuid");
                                    var device_battery = localStorage.getItem("device_battery");



                                    $.get("http://250taxi.com/db/account/set_randomclientid.php?&userid=" + userid + "&randomclientid=" + randomclientid + "&device_model=" + device_model + "&device_platform=" + device_platform + "&device_version=" + device_version + "&device_uuid=" + device_uuid + "&device_battery=" + device_battery + "", function(data) {
                                        document.location.href = '../gotostart.html';

                                    });


                                } else if (pindata == "pin_not_found") {
                                    alert("Sorry, your PIN was incorrect. Please check your PIN or contact support.");
									hideindicator();
                                }

                            });
                        });

                    } else if (data == "account_not_found") {
						
						hideindicator();
						
                        alert("Sorry, your account was not found. Please check your username or contact support.");
                    }
                });
            }

        </script>

        
       <!--------GOOGLE BUTTON--------->
		<div class="googleBtn" style="z-index:99999:text-align:center">
		<div class="g-signin2" data-longtitle="true" data-onsuccess="Google_signIn" approvalprompt= "force" prompt="login" data-theme="light" data-width="200"></div>
		</div> 
		
		<div style="display:none;">
		<!--------FACEBOOK BUTTON--------->
		<button id="loginBtn" onclick="logIn();" value="Login">Login with Facebook</button>
		<button id="logoutBtn" onclick="logOut();" value="Logout">Logout</button>
		</div>
		

        <div id="scanqr" class="windowbutton waves-effect waves-dark" onclick="scancode_hotel_corporate();">
            <img style="width: 50px; vertical-align: middle;" id="scan_qr" src="scan_qr.png"> Hotel / Corporate Login
        </div>

    </div>

    <div id="loginscreenforgot" style="display:none;">
		
        <h1>Please enter your E-Mail</h1>

        <div class="instructions">You will recieve an E-Mail with instructions.</div>

        <input id="loginemailforgot" class="textfield" type="email" placeholder="eMail">

        <div class="windowbutton" onClick="loginforgotgo();">Go</div>

        <div class="windowbutton" onClick="loginforgotcancel();">Cancel</div>

    </div>

    <br>

</body>
</html>


	<!------------ GOOGLE LOGIN SCRIPT -------------->
	
    <script src="https://apis.google.com/js/platform.js" async defer></script>
	<meta name="google-signin-client_id" content="786092302025-1lj1os9nkn4fdkc5dbor1rldsjml3i5u.apps.googleusercontent.com">
	<script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>
	<script type="text/javascript">
	
	function Google_signIn(googleUser) {
		var auth2 = gapi.auth2.getAuthInstance();
		auth2.signOut();
		var profile = googleUser.getBasicProfile();
		console.log('ID: ' + profile.getId());
		console.log('Name: ' + profile.getName());
		console.log('Image URL: ' + profile.getImageUrl());
		console.log('Email: ' + profile.getEmail());
		
		$.ajax({
			type: "POST",
            data: profile,
            url: 'http://250taxi.com/app/google_login.php',
            success: function(msg) {
				msg1=msg.split("|");
				var username=profile.getEmail();
				user=username.split('@');
				localStorage.setItem("userid", msg1[1]);  						// Set user id
				localStorage.setItem("username", user[0]); 						// Set username
				var randomclientid = Math.floor(Math.random() * 1000000000);	// Generate randomclientid
				localStorage.setItem("randomclientid", randomclientid);			// Set randomclientid
				
				if(msg1[0] == "AskForPhoneNumber"){				
					$("#inputUsername").val(user[0]);$("#userEmail").val(profile.getEmail());$("#userId").val(msg1[1]);
					$("#inputEmail").val(profile.getEmail())
					$("#myModal").modal({
							backdrop: 'static',
							keyboard: false
					});
					$("#myModal").modal('show');
						
				}
				else{
					localStorage.setItem("rememberuser", "Yes");				// Set rememberuser
					localStorage.removeItem("hotelcorporate");
					
					var userid=localStorage.getItem("userid");					
					var userid = localStorage.getItem("userid");
					var battery = navigator.battery || navigator.mozBattery;
					if (battery) {												// battery status for firefox						 
						var device_battery = (battery.level * 100);
						localStorage.setItem("device_battery",device_battery);
					} 
					else if (navigator.getBattery) {							//battery status for chrome						
						navigator.getBattery().then(function(battery) {
							var device_battery = (battery.level * 100);
							localStorage.setItem("device_battery",device_battery);
						});
					}
											
					var device_model = localStorage.getItem("device_model");
					var device_platform = localStorage.getItem("device_platform");
					var device_version = localStorage.getItem("device_version");
					var device_uuid = localStorage.getItem("device_uuid");
					var device_battery = localStorage.getItem("device_battery");
					
					$.get("http://250taxi.com/db/account/set_randomclientid.php?&userid=" + userid + "&randomclientid=" + randomclientid + "&device_model=" + device_model + "&device_platform=" + device_platform + "&device_version=" + device_version + "&device_uuid=" + device_uuid + "&device_battery=" + device_battery + "", function(data) {
					
					   document.location.href = '../gotostart.html'; 			// Redirecting to GotoStart after successful Login

					});
				}
			}
      });
}

function signOut() {
   var auth2 = gapi.auth2.getAuthInstance();
   auth2.signOut().then(function () {
   console.log('User signed out.');
   });
}

$(document).ready(function(){

	$( "#userForm" ).submit(function( event ) {			//Trigger on submit the pop-up form
		var inputUsername= $("#inputUsername").val();
		var inputPin= $("#inputPin").val();
		var inputPhone= $("#inputPhone").val();
		var inputEmail= $("#inputEmail").val();
		var userId= $("#userId").val();
		var email= $("#userEmail").val(); 

		localStorage.setItem("rememberuser", "Yes");
		if(userId==""){
			var userid=localStorage.getItem("userid");
		} 
		else{
			var userid=userId;
		}

		var userid = localStorage.getItem("userid");
		var battery = navigator.battery || navigator.mozBattery;
		if (battery) {			
				var device_battery = (battery.level * 100);			// battery status for firefox 
				localStorage.setItem("device_battery",device_battery);
		} 
		else if (navigator.getBattery) {
			navigator.getBattery().then(function(battery) {		//battery status for chrome
				var device_battery = (battery.level * 100);
				localStorage.setItem("device_battery",device_battery);
			});
		}
		
		localStorage.removeItem("randomclientid");
		var randomclientid = Math.floor(Math.random() * 1000000000);
        localStorage.setItem("randomclientid", randomclientid);          

        var device_model = localStorage.getItem("device_model");
        var device_platform = localStorage.getItem("device_platform");
        var device_version = localStorage.getItem("device_version");
        var device_uuid = localStorage.getItem("device_uuid");
        var device_battery = localStorage.getItem("device_battery");
			
		console.log(localStorage.getItem("userid"));console.log(localStorage.getItem("username"));
		console.log(localStorage.getItem("randomclientid"));console.log(localStorage.getItem("rememberuser"));
		
		$.get( "http://250taxi.com/app/account_update.php?username="+inputUsername+"&pin="+inputPin+"&phone="+inputPhone+"&email="+email+"&randomclientid="+randomclientid+"&inputEmail="+inputEmail,  function( data ) {	
			//alert(data);
			alert("You are successfully registered on 250 Taxi.");
			$("#myModal").modal('hide');
			$.get("http://250taxi.com/db/account/set_randomclientid.php?&userid=" + userid + "&randomclientid=" + randomclientid + "&device_model=" + device_model + "&device_platform=" + device_platform + "&device_version=" + device_version + "&device_uuid=" + device_uuid + "&device_battery=" + device_battery + "", function(data) {
			
					document.location.href = '../gotostart.html';  		// Redirecting to GotoStart after successful Login

			});
		});
			 
		event.preventDefault();
	});
	});
  </script>

   

	<!------------ ! GOOGLE LOGIN SCRIPT -------------->
	
<!------------ Pop up for completing registration process -------------->

<div id="myModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Please fill out the form below to proceed:</h4>
            </div>
            <div class="modal-body" style="text-align:center">		
			<form name="userForm" id="userForm">
				<label for="inputUsername" class="sr-only">Username</label>
				<input type="text" id="inputUsername" class="form-control" placeholder="Username" value="" required autofocus>
				<br>
				<label for="inputEmail" class="sr-only">Email</label>
				<input type="text" id="inputEmail" class="form-control" placeholder="Email" required>
				<br>
				<label for="inputPin" class="sr-only">Pin</label>
				<input type="text" id="inputPin" class="form-control" placeholder="Pin" maxlength="4" required >
				<br>
				<label for="inputPhone" class="sr-only">Phone</label>
				<input type="text" id="inputPhone" class="form-control" placeholder="Phone" required>
				<br>
				<input type="hidden" name="userEmail" id="userEmail" value="">
				<input type="hidden" name="userId" id="userId" value="">
				<input type="submit" value="Save">
			</form>
			</div>
        </div>
    </div>
</div>

<!------------ ! Pop up for completing registration process -------------->

<link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
 
	<!------------ FACEBOOK LOGIN CODE -------------->

	<script src="https://connect.facebook.net/en_US/all.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>	
	<script>
	$( document ).ready(function() {
		$('#logoutBtn').hide();
		$('#userDetails').hide();
	});

	function fbAsyncInit() {
		FB.init({
			appId      : '497708020411902', // Fb App ID
			status     : true, // check login status
			cookie     : true, // enable cookies to allow the server to access the session
			xfbml      : true  // parse XFBML
		});
	}
	function logIn() {
	  	FB.login(
	        function(response) {
				if (response.status== 'connected') {
					FB.api('/me', function(response) {
				    	console.log(response);
				      	console.log('Good to see you, ' + response.name + '.');
				      	$('#loginBtn').hide();
				      	$('#logoutBtn').show();
						$('#userDetails').show();
						$('#userInfo').html(response.name + '<br>');
						var name=response.name;var id=response.id;
						//var email=response.email;
						$.get( "http://250taxi.com/app/fb_login.php?name="+name+"&id="+id,  function( data ) {
							
							var data1=data.split("|");
							alert(data)	;
							localStorage.setItem("userid", data1[0]);
							localStorage.setItem("username", id);
							localStorage.setItem("rememberuser", "Yes");
							var userid=localStorage.getItem("userid");
							var randomclientid = Math.floor(Math.random() * 1000000000);
							localStorage.setItem("randomclientid", randomclientid); 
							var userid = localStorage.getItem("userid");
							var battery = navigator.battery || navigator.mozBattery;
							if (battery) {
								// battery status for firefox 
									var device_battery = (battery.level * 100);
								localStorage.setItem("device_battery",device_battery);
							} else if (navigator.getBattery) {
								//battery status for chrome
								navigator.getBattery().then(function(battery) {
									var device_battery = (battery.level * 100);
									localStorage.setItem("device_battery",device_battery);
								});
							}
							var device_model = localStorage.getItem("device_model");
							var device_platform = localStorage.getItem("device_platform");
							var device_version = localStorage.getItem("device_version");
							var device_uuid = localStorage.getItem("device_uuid");
							var device_battery = localStorage.getItem("device_battery");
							if(data1[1] == "AskForPhoneNumber"){				
							$("#inputUsername").val(id);
							$("#myModal").modal({
								backdrop: 'static',
								keyboard: false
							});
							$("#myModal").modal('show');					
						}
						else{
						console.log(localStorage.getItem("userid"));console.log(localStorage.getItem("username"));
						console.log(localStorage.getItem("randomclientid"));console.log(localStorage.getItem("rememberuser"));
							  $.get("http://250taxi.com/db/account/set_randomclientid.php?&userid=" + userid + "&randomclientid=" + randomclientid + "&device_model=" + device_model + "&device_platform=" + device_platform + "&device_version=" + device_version + "&device_uuid=" + device_uuid + "&device_battery=" + device_battery + "", function(data) {
							 document.location.href = '../gotostart.html';  

								});
						
						}
						});						
				    });

				    FB.api("/me/picture?width=200&redirect=0&type=normal&height=200", function (response) {
				      	if (response && !response.error) {
				        	/* handle the result */
				        	console.log('PIC ::', response);
				        	//$('#userPic').attr('src', response.data.url);
							//$('#userPic').append(response.name );
				      	}
				    });
				}
			}
		);
	}

	function logOut() {
		FB.logout(function(response) {
			console.log('logout :: ', response);
			//Removing access token form localStorage.
			$('#loginBtn').show();
			$('#logoutBtn').hide();
			$('#userDetails').hide();
		});
	}

	fbAsyncInit();
	  
	</script>
	
	<style>
	#loginBtn{
	display: inline-block;
	color:white;
	}
	.googleBtn{
	display: inline-block;
	}
	.g-signin2{
	display: inline-block;}
	</style>


	
	<!------------ ! FACEBOOK LOGIN CODE -------------->
