<!doctype html>
<html>
<head>
<meta charset="utf-8">
    
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link href="main.css" rel="stylesheet" type="text/css">
<link href="animate.min.css" rel="stylesheet" type="text/css">

<script type="text/javascript" charset="utf-8" src="jquery-1.9.1.js"></script>
<script type="text/javascript" charset="utf-8" src="logic.js"></script>
    
<script src="../preventreload.js"></script>

<script type="text/javascript">
$( document ).ready(function() {
    
$('#username').keyup(function(){
    this.value = this.value.toLowerCase();
    this.value = this.value.replace(/ /g, "");
});
$(function(){
    $('#username').keypress(function(e){
        var txt = String.fromCharCode(e.which);
        console.log(txt + ' : ' + e.which);
        if(!txt.match(/[A-Za-z0-9]/))//+#-.
        {
            return false;
        }
    });
});

var username = localStorage.getItem('username');
document.getElementById('username').value = username;

first_name = localStorage.getItem('first_name');
last_name = localStorage.getItem('last_name');

if (localStorage.getItem('first_name') === null) {
    console.log('Names not found.')
}
else {
    document.getElementById('first_name').innerHTML = first_name;
    document.getElementById('last_name').innerHTML = last_name;
}

setTimeout(function(){
document.getElementById("loadingindicator").className = "animated fadeOut";
}, 1000);
setTimeout(function(){
	document.getElementById("loadingindicator").style.display = "none";
}, 2000);

setTimeout(function(){
document.getElementById("mainmenu").style.display = "block";
document.getElementById("mainmenu").className = "nicewindow animated zoomIn";
}, 2500);
});
</script>

</head>

<body>
    
<div id="offline" class="animated fadeIn">
<img src="cloud.png">
<div>You are offline. This app requires an active internet connection.</div>
</div>

<div id="loadingindicator" style="display:block;">
<img src="282.gif">
</div>

<div id="mainmenu" class="nicewindow" style="display:none;">

<div id="loginscreenstart">
    <h1>Welcome <span id="first_name"></span> <span id="last_name"></span></h1>

<div style="clear:both;"></div>
    
<select style="display:none;" id="countrycode" class="textfield">
    <option value="+243">+243 (DRC)</option>
    <option value="+250">+250 (Rwanda)</option>
    <option value="+256">+256 (Uganda)</option>
    <option value="+257">+257 (Burundi)</option>
    <option value="+254">+254 (Kenya)</option>
    <option value="+49">+49 (Germany)</option>
</select>

<input style="display:none;" name="phone" id="phone" type="tel" class="textfield" required placeholder="Phone">
    
Please sign in with your<br>username and PIN.
    
<input name="username" id="username" type="text" class="textfield" required placeholder="Username">

<div style="clear:both;"></div>

</div>

<br>

<center>
<input id="loginpin" style="width:100px;" class="textfield pin" type="tel" placeholder="PIN" maxlength = "4" pattern=".{4,}"> 
</center>
    
<br>
    
<script>
   function logincheck() {
	var phone = document.getElementById('phone').value.replace(/^[0]+/g,"");
	var countrycode = document.getElementById('countrycode').value;
       
    var phone = ''+countrycode+''+phone+'';
       
    var username = document.getElementById('username').value;

	var loginpin = document.getElementById('loginpin').value;
	// alert(''+phone+' '+loginpin+'');
       
    $.get( "http://250taxi.com/db/check-username-login.php?username="+username+"", function( data ) {

        if (data == "account_found") {
            
                $.get( "http://250taxi.com/db/check-pin.php?pin="+loginpin+"", function( data ) {

                if (data == "pin_found") {
                localStorage.setItem("rememberuser","Yes");
                document.location.href = '../gotostart.html';
                }
                else if (data == "pin_not_found") {
                alert("Sorry, your PIN was incorrect. Please check your PIN or contact support.");
                    
        }
    });
            
        }
        else if (data == "account_not_found") {
            alert("Sorry, your account was not found. Please check your username or contact support.");
        }
    });
   } 
</script>

<div class="windowbutton" onClick="logincheck();">Login</div>

<div class="windowbutton" onClick="alert('Please contact customer support: info@250taxi.com');">Forgot username or PIN?</div>
</div>

<div id="loginscreenforgot" style="display:none;">
<h1>Please enter your eMail</h1>

<div class="instructions">You will recieve an eMail with instructions.</div>

<input id="loginemailforgot" class="textfield" type="email" placeholder="eMail">

<div class="windowbutton" onClick="loginforgotgo();">Go</div>

<div class="windowbutton" onClick="loginforgotcancel();">Cancel</div>

</div>

<br>

</div>

</body>
</html>